machine:
  services:
    - docker

dependencies:
  pre:
    - curl -L https://github.com/docker/machine/releases/download/v0.7.0/docker-machine-`uname -s`-`uname -m` > ~/bin/docker-machine
    - chmod +x ~/bin/docker-machine

  cache_directories:
    - ~/docker
    - ~/bin

deployment:
  hub:
    branch: features/docker
    commands:
      - eval `aws ecr get-login`
      - docker --version
      - ~/bin/docker-machine --version
      - echo $PWD
      - export DOCKER_TLS_VERIFY="1" && export DOCKER_HOST="tcp://54.196.215.148:2376" && export DOCKER_CERT_PATH="$PWD/machines/app.production" && export DOCKER_MACHINE_NAME="app.production" && eval $(docker-machine env app.production)
      - docker-machine ls

test:
  override:
    - echo 'Skip'
    # - RAILS_ENV=test bundle exec rspec -r rspec_junit_formatter --format RspecJunitFormatter -o $CIRCLE_TEST_REPORTS/rspec/junit.xml
