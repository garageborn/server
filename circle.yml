# machine:
#   pre:
#     - curl -sSL https://s3.amazonaws.com/circle-downloads/install-circleci-docker.sh | bash -s -- 1.10.0
#   services:
#     - docker

dependencies:
  pre:
    - wget -qO- https://get.docker.com/ | sh
    - curl -L https://github.com/docker/machine/releases/download/v0.8.0/docker-machine-`uname -s`-`uname -m` > ~/bin/docker-machine
    - curl -L https://github.com/docker/compose/releases/download/1.8.0/docker-compose-`uname -s`-`uname -m` > ~/bin/docker-compose
    - chmod +x ~/bin/docker-machine ~/bin/docker-compose

  cache_directories:
    - /tmp/docker
    - ~/bin

deployment:
  hub:
    branch: features/docker
    commands:
      - docker --version
      - docker-machine --version
      - docker-compose --version
      - docker-machine --storage-path docker/machine ls
      - eval $(docker-machine --storage-path docker/machine env app.production)
      - docker-compose ps
      - docker-machine --storage-path docker/machine start app.production
      - docker-compose ps
      - bundle exec rake deploy

test:
  override:
    - echo 'Skip'
